{"version":3,"sources":["../src/Get.js"],"names":["bool","oneOf","string","BaseComponent","attachmentsAsUint8Arrays","changesCache","renderProps","withDB","UINT8ARRAY","ALLOWED_LIVE_OPTIONS","Get","options","db","props","id","attachments","otherOptions","optionsWithAttachmentAndBinaryOption","binary","get","setStateIfMounted","every","includes","option","cancel","live","include_docs","since","doc_ids","doc","nextState","exists","_attachments","_deleted","otherProps","state","propTypes","isRequired"],"mappings":";;;;;;;;;;;AAAA,SAASA,IAAT,EAAeC,KAAf,EAAsBC,MAAtB,QAAoC,YAApC;AACA,OAAOC,aAAP,MAA0B,iBAA1B;AACA,OAAOC,wBAAP,MAAqC,4BAArC;AACA,OAAOC,YAAP,MAAyB,gBAAzB;AACA,OAAOC,WAAP,MAAwB,eAAxB;AACA,OAAOC,MAAP,MAAmB,UAAnB;AAEA,IAAMC,aAAa,KAAnB;AACA,IAAMC,uBAAuB,CAAC,aAAD,EAAgB,MAAhB,EAAwB,QAAxB,EAAkC,IAAlC,CAA7B;;IAEMC,G;;;;;;;;;;;;;;;;;;;;aAOI;;;;;;;;;iDACKC,O;;;;;;;;AACMC,kB,GAAS,I,CAAlBC,K,CAASD,E;AACTE,kB,GAAqCH,O,CAArCG,E,EAAIC,W,GAAiCJ,O,CAAjCI,W,EAAgBC,Y,4BAAiBL,O;AACvCM,oD;AACJC,0BAAQH,gBAAgBP;mBACrBQ,Y;AACHD,+BAAa,CAAC,CAACA;;+BAGf,I;;uBACQ,KAAKI,GAAL,CAASL,EAAT,EAAaG,oCAAb,C;;;;;kCADHG,iB;;;;;AAIL;AACA,oBACE,aAAYT,OAAZ,EAAqBU,KAArB,CAA2B;AAAA,yBACzBZ,qBAAqBa,QAArB,CAA8BC,MAA9B,CADyB;AAAA,iBAA3B,CADF,EAIE;AACA,uBAAKC,MAAL,GAAkBnB,YAAJ,4BAEPY,oCAFO;AAGVQ,0BAAM,IAHI;AAIVC,kCAAc,IAJJ;AAKVC,2BAAO,KALG;AAMVC,6BAAS,CAACd,EAAD;AANC;AAAA;AAAA;AAAA;AAAA;AAAA,6CAQZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAASe,iCAAT,SAASA,GAAT;AAAA,4CAAmB,MAAnB;AAAA;AAAA,qCAAgD,OAAKC,SAAL,CAAeD,GAAf,CAAhD;;AAAA;AAAA;AAAA,2EAAwBT,iBAAxB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBARY;;AAAA;AAAA;AAAA;AAAA,sBAAd;AAUD;;;;;;;;;;;;;;;;;;;iDAGKN,E,EAAIH,O;;;;;;AACKC,kB,GAAS,I,CAAlBC,K,CAASD,E;;+BAEF,I;;uBAAqBA,GAAGO,GAAH,CAAOL,EAAP,EAAWH,OAAX,C;;;;;oCAAhBmB,S;;;;;;;;kDAEX;AACLC,0BAAQ;AADH,iB;;;;;;;;;;;;;;;;;;;iDAKKF,G;;;;;sBAGV,KAAKhB,KAAL,CAAWE,WAAX,KAA2BP,U;;;;;;uBACjBJ,yBAAyByB,IAAIG,YAA7B,C;;;;;;;;+BACNH,IAAIG,Y;;;;+BACVH,G;+BACQ,CAACA,IAAII,Q;;AALblB,6B;AAIAc,qB;AACAE,wB;;;;;;;;;;;;;;;;;6BAGK;AAAA,mBAC4D,IAD5D,CACClB,KADD;AAAA,UACUD,EADV,UACUA,EADV;AAAA,UACiBsB,UADjB;AAAA,UAC+BC,KAD/B,GAC4D,IAD5D,CAC+BA,KAD/B;AAAA,UAC+CJ,MAD/C,GAC4D,IAD5D,CACsCI,KADtC,CAC+CJ,MAD/C;;AAEP,aAAOzB,YAAY4B,UAAZ,EAAwBH,MAAxB;AAAkCnB;AAAlC,SAAyCuB,KAAzC,EAAP;AACD;;;;EA/DehC,a;;sBAAZO,G;;;;2BAECP,cAAciC,S;AACjBrB,iBAAad,MAAM,CAAC,IAAD,EAAO,KAAP,EAAcO,UAAd,CAAN,C;AACbU,YAAQlB,I;AACRc,QAAIZ,OAAOmC;;;AA6Df,eAAe9B,OAAOG,GAAP,CAAf","sourcesContent":["import { bool, oneOf, string } from 'prop-types';\nimport BaseComponent from './BaseComponent';\nimport attachmentsAsUint8Arrays from './attachmentsAsUint8Arrays';\nimport changesCache from './changesCache';\nimport renderProps from './renderProps';\nimport withDB from './withDB';\n\nconst UINT8ARRAY = 'u8a';\nconst ALLOWED_LIVE_OPTIONS = ['attachments', 'ajax', 'binary', 'id'];\n\nclass Get extends BaseComponent {\n  static propTypes = {\n    ...BaseComponent.propTypes,\n    attachments: oneOf([true, false, UINT8ARRAY]),\n    binary: bool,\n    id: string.isRequired\n  };\n  state = {};\n  async listen(options) {\n    const { props: { db } } = this;\n    const { id, attachments, ...otherOptions } = options;\n    const optionsWithAttachmentAndBinaryOption = {\n      binary: attachments === UINT8ARRAY,\n      ...otherOptions,\n      attachments: !!attachments\n    };\n    if (\n      this.setStateIfMounted(\n        await this.get(id, optionsWithAttachmentAndBinaryOption)\n      )\n    ) {\n      // Live?\n      if (\n        Object.keys(options).every(option =>\n          ALLOWED_LIVE_OPTIONS.includes(option)\n        )\n      ) {\n        this.cancel = db::changesCache(\n          {\n            ...optionsWithAttachmentAndBinaryOption,\n            live: true,\n            include_docs: true,\n            since: 'now',\n            doc_ids: [id]\n          },\n          async ({ doc }) => this.setStateIfMounted(await this.nextState(doc))\n        );\n      }\n    }\n  }\n  async get(id, options) {\n    const { props: { db } } = this;\n    try {\n      return await this.nextState(await db.get(id, options));\n    } catch {\n      return {\n        exists: false\n      };\n    }\n  }\n  async nextState(doc) {\n    return {\n      attachments:\n        this.props.attachments === UINT8ARRAY\n          ? await attachmentsAsUint8Arrays(doc._attachments)\n          : doc._attachments,\n      doc,\n      exists: !doc._deleted\n    };\n  }\n  render() {\n    const { props: { db, ...otherProps }, state, state: { exists } } = this;\n    return renderProps(otherProps, exists, { db, ...state });\n  }\n}\n\nexport default withDB(Get);\n"],"file":"Get.js"}