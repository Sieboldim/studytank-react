{"version":3,"sources":["../../src/pouchdbConnections.js"],"names":["dbs","userCounts","create","options","key","db","get","PouchDB","userCount","set","close","delete"],"mappings":";;;;;;;;;;;;AAAA;;AACA;;AACA;;AAEA,IAAMA,MAAM,kBAAZ;AACA,IAAMC,aAAa,kBAAnB;;AAEO,SAASC,MAAT,CAAgBC,OAAhB,EAAyB;AAC9B,MAAMC,MAAM,kCAAUD,OAAV,CAAZ;;AACA,MAAME,KAAUC,4BAAL,WAASF,GAAT,EAAc;AAAA,WAAM,IAAIG,uBAAJ,CAAYJ,OAAZ,CAAN;AAAA,GAAd,CAAX;;AACA,MAAMK,YAAwBF,4BAAZ,kBAAgBF,GAAhB,EAAqB;AAAA,WAAM,CAAN;AAAA,GAArB,CAAlB;;AACAH,aAAWQ,GAAX,CAAeL,GAAf,EAAoBI,YAAY,CAAhC;AACA,SAAOH,EAAP;AACD;;AAEM,SAASK,KAAT,CAAeP,OAAf,EAAwB;AAC7B,MAAMC,MAAM,kCAAUD,OAAV,CAAZ;AACA,MAAMK,YAAYP,WAAWK,GAAX,CAAeF,GAAf,IAAsB,CAAxC;AACAH,aAAWQ,GAAX,CAAeL,GAAf,EAAoBI,SAApB;;AACA,MAAI,CAACA,SAAL,EAAgB;AACdR,QAAIM,GAAJ,CAAQF,GAAR,EAAaM,KAAb;AACAV,QAAIW,MAAJ,CAAWP,GAAX;AACD;AACF","sourcesContent":["import PouchDB from 'pouchdb';\nimport stringify from 'json-stable-stringify';\nimport get from './getWithDefaultValue';\n\nconst dbs = new Map();\nconst userCounts = new Map();\n\nexport function create(options) {\n  const key = stringify(options);\n  const db = dbs::get(key, () => new PouchDB(options));\n  const userCount = userCounts::get(key, () => 0);\n  userCounts.set(key, userCount + 1);\n  return db;\n}\n\nexport function close(options) {\n  const key = stringify(options);\n  const userCount = userCounts.get(key) - 1;\n  userCounts.set(key, userCount);\n  if (!userCount) {\n    dbs.get(key).close();\n    dbs.delete(key);\n  }\n}\n"],"file":"pouchdbConnections.js"}