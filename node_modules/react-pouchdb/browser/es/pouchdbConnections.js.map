{"version":3,"sources":["../../src/pouchdbConnections.js"],"names":["PouchDB","stringify","get","dbs","userCounts","create","options","key","db","userCount","set","close","delete"],"mappings":";AAAA,OAAOA,OAAP;AACA,OAAOC,SAAP,MAAsB,uBAAtB;AACA,OAAOC,GAAP,MAAgB,uBAAhB;AAEA,IAAMC,MAAM,UAAZ;AACA,IAAMC,aAAa,UAAnB;AAEA,OAAO,SAASC,MAAT,CAAgBC,OAAhB,EAAyB;AAC9B,MAAMC,MAAMN,UAAUK,OAAV,CAAZ;AACA,MAAME,KAAUN,GAAL,WAASK,GAAT,EAAc;AAAA,WAAM,IAAIP,OAAJ,CAAYM,OAAZ,CAAN;AAAA,GAAd,CAAX;AACA,MAAMG,YAAwBP,GAAZ,kBAAgBK,GAAhB,EAAqB;AAAA,WAAM,CAAN;AAAA,GAArB,CAAlB;AACAH,aAAWM,GAAX,CAAeH,GAAf,EAAoBE,YAAY,CAAhC;AACA,SAAOD,EAAP;AACD;AAED,OAAO,SAASG,KAAT,CAAeL,OAAf,EAAwB;AAC7B,MAAMC,MAAMN,UAAUK,OAAV,CAAZ;AACA,MAAMG,YAAYL,WAAWF,GAAX,CAAeK,GAAf,IAAsB,CAAxC;AACAH,aAAWM,GAAX,CAAeH,GAAf,EAAoBE,SAApB;;AACA,MAAI,CAACA,SAAL,EAAgB;AACdN,QAAID,GAAJ,CAAQK,GAAR,EAAaI,KAAb;AACAR,QAAIS,MAAJ,CAAWL,GAAX;AACD;AACF","sourcesContent":["import PouchDB from 'pouchdb';\nimport stringify from 'json-stable-stringify';\nimport get from './getWithDefaultValue';\n\nconst dbs = new Map();\nconst userCounts = new Map();\n\nexport function create(options) {\n  const key = stringify(options);\n  const db = dbs::get(key, () => new PouchDB(options));\n  const userCount = userCounts::get(key, () => 0);\n  userCounts.set(key, userCount + 1);\n  return db;\n}\n\nexport function close(options) {\n  const key = stringify(options);\n  const userCount = userCounts.get(key) - 1;\n  userCounts.set(key, userCount);\n  if (!userCount) {\n    dbs.get(key).close();\n    dbs.delete(key);\n  }\n}\n"],"file":"pouchdbConnections.js"}