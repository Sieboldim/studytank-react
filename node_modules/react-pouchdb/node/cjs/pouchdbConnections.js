"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.create = create;
exports.close = close;

var _map = _interopRequireDefault(require("@babel/runtime/core-js/map"));

var _pouchdbNode = _interopRequireDefault(require("pouchdb-node"));

var _jsonStableStringify = _interopRequireDefault(require("json-stable-stringify"));

var _getWithDefaultValue = _interopRequireDefault(require("./getWithDefaultValue"));

var dbs = new _map.default();
var userCounts = new _map.default();

function create(options) {
  var key = (0, _jsonStableStringify.default)(options);

  var db = _getWithDefaultValue.default.call(dbs, key, function () {
    return new _pouchdbNode.default(options);
  });

  var userCount = _getWithDefaultValue.default.call(userCounts, key, function () {
    return 0;
  });

  userCounts.set(key, userCount + 1);
  return db;
}

function close(options) {
  var key = (0, _jsonStableStringify.default)(options);
  var userCount = userCounts.get(key) - 1;
  userCounts.set(key, userCount);

  if (!userCount) {
    dbs.get(key).close();
    dbs.delete(key);
  }
}
//# sourceMappingURL=pouchdbConnections.js.map