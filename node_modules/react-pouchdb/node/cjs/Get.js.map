{"version":3,"sources":["../../src/Get.js"],"names":["UINT8ARRAY","ALLOWED_LIVE_OPTIONS","Get","options","db","props","id","attachments","otherOptions","optionsWithAttachmentAndBinaryOption","binary","get","setStateIfMounted","every","includes","option","cancel","changesCache","live","include_docs","since","doc_ids","doc","nextState","exists","_attachments","_deleted","otherProps","state","BaseComponent","propTypes","bool","string","isRequired"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEA,IAAMA,aAAa,KAAnB;AACA,IAAMC,uBAAuB,CAAC,aAAD,EAAgB,MAAhB,EAAwB,QAAxB,EAAkC,IAAlC,CAA7B;;IAEMC,G;;;;;;;;;;;;;;;;;;;;aAOI;;;;;;;;;kDACKC,O;;;;;;;;AACMC,kB,GAAS,I,CAAlBC,K,CAASD,E;AACTE,kB,GAAqCH,O,CAArCG,E,EAAIC,W,GAAiCJ,O,CAAjCI,W,EAAgBC,Y,0CAAiBL,O;AACvCM,oD;AACJC,0BAAQH,gBAAgBP;mBACrBQ,Y;AACHD,+BAAa,CAAC,CAACA;;+BAGf,I;;uBACQ,KAAKI,GAAL,CAASL,EAAT,EAAaG,oCAAb,C;;;;;kCADHG,iB;;;;;AAIL;AACA,oBACE,mBAAYT,OAAZ,EAAqBU,KAArB,CAA2B;AAAA,yBACzBZ,qBAAqBa,QAArB,CAA8BC,MAA9B,CADyB;AAAA,iBAA3B,CADF,EAIE;AACA,uBAAKC,MAAL,GAAkBC,qBAAJ,0CAEPR,oCAFO;AAGVS,0BAAM,IAHI;AAIVC,kCAAc,IAJJ;AAKVC,2BAAO,KALG;AAMVC,6BAAS,CAACf,EAAD;AANC;AAAA;AAAA;AAAA;AAAA;AAAA,8CAQZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAASgB,iCAAT,SAASA,GAAT;AAAA,4CAAmB,MAAnB;AAAA;AAAA,qCAAgD,OAAKC,SAAL,CAAeD,GAAf,CAAhD;;AAAA;AAAA;AAAA,2EAAwBV,iBAAxB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBARY;;AAAA;AAAA;AAAA;AAAA,sBAAd;AAUD;;;;;;;;;;;;;;;;;;;kDAGKN,E,EAAIH,O;;;;;;AACKC,kB,GAAS,I,CAAlBC,K,CAASD,E;;+BAEF,I;;uBAAqBA,GAAGO,GAAH,CAAOL,EAAP,EAAWH,OAAX,C;;;;;oCAAhBoB,S;;;;;;;;kDAEX;AACLC,0BAAQ;AADH,iB;;;;;;;;;;;;;;;;;;;kDAKKF,G;;;;;sBAGV,KAAKjB,KAAL,CAAWE,WAAX,KAA2BP,U;;;;;;uBACjB,uCAAyBsB,IAAIG,YAA7B,C;;;;;;;;+BACNH,IAAIG,Y;;;;+BACVH,G;+BACQ,CAACA,IAAII,Q;;AALbnB,6B;AAIAe,qB;AACAE,wB;;;;;;;;;;;;;;;;;6BAGK;AAAA,mBAC4D,IAD5D,CACCnB,KADD;AAAA,UACUD,EADV,UACUA,EADV;AAAA,UACiBuB,UADjB;AAAA,UAC+BC,KAD/B,GAC4D,IAD5D,CAC+BA,KAD/B;AAAA,UAC+CJ,MAD/C,GAC4D,IAD5D,CACsCI,KADtC,CAC+CJ,MAD/C;AAEP,aAAO,0BAAYG,UAAZ,EAAwBH,MAAxB;AAAkCpB;AAAlC,SAAyCwB,KAAzC,EAAP;AACD;;;EA/DeC,uB;;sBAAZ3B,G;;;;yCAEC2B,wBAAcC,S;AACjBvB,iBAAa,sBAAM,CAAC,IAAD,EAAO,KAAP,EAAcP,UAAd,CAAN,C;AACbU,YAAQqB,e;AACRzB,QAAI0B,kBAAOC;;;;eA6DA,qBAAO/B,GAAP,C","sourcesContent":["import { bool, oneOf, string } from 'prop-types';\nimport BaseComponent from './BaseComponent';\nimport attachmentsAsUint8Arrays from './attachmentsAsUint8Arrays';\nimport changesCache from './changesCache';\nimport renderProps from './renderProps';\nimport withDB from './withDB';\n\nconst UINT8ARRAY = 'u8a';\nconst ALLOWED_LIVE_OPTIONS = ['attachments', 'ajax', 'binary', 'id'];\n\nclass Get extends BaseComponent {\n  static propTypes = {\n    ...BaseComponent.propTypes,\n    attachments: oneOf([true, false, UINT8ARRAY]),\n    binary: bool,\n    id: string.isRequired\n  };\n  state = {};\n  async listen(options) {\n    const { props: { db } } = this;\n    const { id, attachments, ...otherOptions } = options;\n    const optionsWithAttachmentAndBinaryOption = {\n      binary: attachments === UINT8ARRAY,\n      ...otherOptions,\n      attachments: !!attachments\n    };\n    if (\n      this.setStateIfMounted(\n        await this.get(id, optionsWithAttachmentAndBinaryOption)\n      )\n    ) {\n      // Live?\n      if (\n        Object.keys(options).every(option =>\n          ALLOWED_LIVE_OPTIONS.includes(option)\n        )\n      ) {\n        this.cancel = db::changesCache(\n          {\n            ...optionsWithAttachmentAndBinaryOption,\n            live: true,\n            include_docs: true,\n            since: 'now',\n            doc_ids: [id]\n          },\n          async ({ doc }) => this.setStateIfMounted(await this.nextState(doc))\n        );\n      }\n    }\n  }\n  async get(id, options) {\n    const { props: { db } } = this;\n    try {\n      return await this.nextState(await db.get(id, options));\n    } catch {\n      return {\n        exists: false\n      };\n    }\n  }\n  async nextState(doc) {\n    return {\n      attachments:\n        this.props.attachments === UINT8ARRAY\n          ? await attachmentsAsUint8Arrays(doc._attachments)\n          : doc._attachments,\n      doc,\n      exists: !doc._deleted\n    };\n  }\n  render() {\n    const { props: { db, ...otherProps }, state, state: { exists } } = this;\n    return renderProps(otherProps, exists, { db, ...state });\n  }\n}\n\nexport default withDB(Get);\n"],"file":"Get.js"}